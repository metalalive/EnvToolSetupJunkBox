
#### HTTP/2 in cURL
To support [http/2](https://datatracker.ietf.org/doc/html/rfc7540) , [curl](https://github.com/curl/curl) actually relies on a third-party library named [nghttp2](https://github.com/nghttp2/nghttp2) , without installation of `nghttp2` , the command `curl --http2 THE_URL_TO_TEST` will silently downgrade to http/1.1 (add `-v` for printing verbose), which is difficult to debug. See [the article](https://curl.se/docs/http2.html) for detail.

#### Build nghttp2 from source
```
CC="/PATH/TO/bin/gcc"  CXX="/PATH/TO/bin/g++"  PKG_CONFIG_PATH=""  cmake   -DENABLE_LIB_ONLY=ON  ..
make
sudo make install
```
Note that `CMakeLists.txt` in [curl](https://github.com/curl/curl) looks for `libnghttp2.so` only by the command `find_package(xxx)` , but `nghttp2` actually provides useful [pkg-config metadata file](https://en.wikipedia.org/wiki/Pkg-config) that is NOT used in `curl` build process.... 

#### Build curl from source
##### Configure by `./configure` shell script
```
./buildconf
./configure
```
##### Configure by Cmake script
```
CC="/PATH/TO/bin/gcc"  CXX="/PATH/TO/bin/g++"  PKG_CONFIG_PATH=""  cmake -DCMAKE_INSTALL_PREFIX="/PATH/TO/installed"  -DBUILD_SHARED_LIBS=ON -DCURL_DISABLE_DICT=ON  -DCURL_DISABLE_FTP=ON  -DCURL_DISABLE_TFTP=ON  -DCURL_DISABLE_POP3=ON  -DCURL_DISABLE_GOPHER=ON  -DUSE_NGHTTP2=ON  ..
```
You can further disable number of features unecessary in your applications , check out `CMakeLists.txt` for detail.

then build
```
make
make install
```
the built library should be at `/PATH/TO/installed`. (defaults to `/usr/local/lib/libcurl.so`)


#### Usage
* example #1
```
LD_LIBRARY_PATH="/PATH/TO/installed/lib" /PATH/TO/installed/bin/curl --version
```

* example #2
```
LD_LIBRARY_PATH="/PATH/TO/installed/lib" /PATH/TO/installed/bin/curl  \
 --cacert /PATH/TO/CA_CERT_FILE  --key /PATH/TO/PRIVATE_KEY_FILE  \
    --request POST --http2 \
    --header "Content-Type: application/json" \
    --header "Accept: application/json" \
    --header "<CUSTOM_HEADER_LABEL>: <CUSTOM_HEADER_VALUE>" \
    --output - \
    <WHATEVER_DATA> \
    <YOUR_URL_PATH>
```

* During TLS handshake (for https scheme in ` <YOUR_URL_PATH>`) , Both of the endpoints (client and server) performs authentication with the use of the files below :
  * `/PATH/TO/CA_CERT` should be valid certificate file in openssl PEM format
  * `/PATH/TO/PRIVATE_KEY_FILE` should be key file (typically generated by openssl) for verifying signature of server certificate at client side.
* can also specify `--http2` or `--http3`
* `<WHATEVER_DATA>` can be one of following :
  * simple text, e.g. `--data "{\"my_field\": 567}"`
  * complicated textual data, e.g. `--data  @/PATH/TO/LARGE/DATA.json`
  * binary data read from file, e.g. `--form "image=@/PATH/TO/IMAGE_FILE"`
* `--output -` is optional and applied **only** when the response body is NOT textual data (e.g. binary file), in such case you will need to redirect console output to file e.g. `curl -opt1 -opt2 .... http://the.url.com > /PATH/TO/RESPONSE-DATA.bin`.

#### Restriction
- As of version 7.88 (currently the latest version), if TLS v1.3 is applied, it is still NOT possible to fetch [pre-shared key](https://www.rfc-editor.org/rfc/rfc8446#section-4.2.11) from previous `curl` command (more exactly, end of previous TLS handshake) and then reuse the same key for next `curl` command, so the peers always send certificate in each TLS certicate.

#### reference
- https://stackoverflow.com/questions/50740130/tls-psk-support-in-curl
- https://github.com/curl/curl/blob/master/GIT-INFO
